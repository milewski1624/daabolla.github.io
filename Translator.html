<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Polish ↔ English Translator</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* Keep the same color feel as your currency app */
  body { background: linear-gradient(180deg,#eef2ff 0%, #f0f6ff 100%); }
  .glass { background: linear-gradient(180deg, rgba(255,255,255,0.8), #fff); }
  button:disabled { opacity: .6; cursor: not-allowed; }
  /* tiny spinner for inline */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spin { animation: spin 1s linear infinite; }
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
  <div class="max-w-3xl w-full glass rounded-2xl shadow-xl p-6">
    <header class="flex items-start justify-between gap-4 mb-4">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">Polish ↔ English Translator</h1>
        <p class="text-sm text-gray-600 mt-1">Translate between Polish and English instantly. Source: LibreTranslate (free public instance).</p>
      </div>
      <div class="text-right">
        <div id="status" class="text-sm text-indigo-700">Ready</div>
        <div class="mt-2">
          <button id="clearAll" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded-md text-sm">Clear</button>
        </div>
      </div>
    </header>

    <!-- main area -->
    <main class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- input -->
      <section class="p-4 rounded-xl border border-indigo-100">
        <label class="block text-sm font-semibold text-gray-700 mb-2">From</label>
        <div class="flex gap-2 mb-3">
          <select id="fromLang" class="rounded-lg border-indigo-200 px-3 py-2">
            <option value="pl">Polish (pl)</option>
            <option value="en">English (en)</option>
          </select>
          <button id="swapBtn" title="Swap languages" class="bg-indigo-50 border border-indigo-200 px-3 py-2 rounded-lg">↕ Swap</button>
        </div>

        <textarea id="inputText" rows="8" placeholder="Type or paste text here..." 
          class="w-full p-3 rounded-lg border-2 border-indigo-200 focus:ring-2 focus:ring-indigo-400 outline-none resize-y"></textarea>

        <div class="flex items-center gap-2 mt-3">
          <button id="translateBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md font-semibold">Translate</button>
          <button id="autoDetectBtn" class="bg-white border border-indigo-200 px-3 py-2 rounded-md text-sm">Auto-detect</button>
          <div id="loading" class="ml-2 hidden items-center gap-2 text-sm text-indigo-700">
            <svg class="spin w-5 h-5 text-indigo-600" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-opacity="0.25" stroke-width="4"></circle><path d="M4 12a8 8 0 018-8" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path></svg>
            <span>Translating...</span>
          </div>
        </div>
      </section>

      <!-- output -->
      <section class="p-4 rounded-xl border border-indigo-100 flex flex-col">
        <div class="flex items-start justify-between mb-2">
          <div>
            <label class="block text-sm font-semibold text-gray-700">To</label>
            <select id="toLang" class="rounded-lg border-indigo-200 px-3 py-2">
              <option value="en">English (en)</option>
              <option value="pl">Polish (pl)</option>
            </select>
          </div>
          <div class="text-right">
            <div id="lastUpdated" class="text-sm text-gray-500">—</div>
            <div class="mt-2 flex gap-2">
              <button id="copyBtn" class="bg-white border border-indigo-200 px-3 py-1 rounded-md text-sm">Copy</button>
              <button id="speakBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded-md text-sm">Speak</button>
            </div>
          </div>
        </div>

        <div id="outputBox" class="flex-1 p-3 rounded-lg bg-indigo-50 border border-indigo-100 text-gray-800 text-sm overflow-auto min-h-[160px]">
          <em class="text-gray-500">Translated text will appear here</em>
        </div>

        <div class="mt-3 flex items-center justify-between">
          <div class="text-sm text-gray-600" id="charCount">0 chars</div>
          <div class="flex gap-2">
            <button id="saveHistory" class="bg-white border border-indigo-200 px-3 py-1 rounded-md text-sm">Save</button>
            <button id="clearHistory" class="bg-white border border-indigo-200 px-3 py-1 rounded-md text-sm">History</button>
          </div>
        </div>
      </section>
    </main>

    <!-- history area -->
    <section class="mt-4 p-4 bg-white border border-indigo-50 rounded-lg">
      <h3 class="text-sm font-semibold text-gray-700 mb-2">History</h3>
      <div id="historyList" class="space-y-2 text-sm text-gray-700">
        <em class="text-gray-400">No saved translations yet.</em>
      </div>
    </section>

    <footer class="mt-4 text-xs text-gray-500">
      Uses <strong>LibreTranslate</strong> (public instance). If you see CORS or network errors, host this file on GitHub Pages / Netlify or run it from a simple local server.
    </footer>
  </div>

<script>
/* Simple Polish <-> English translator using LibreTranslate public endpoint.
   If you want more reliability, replace the endpoint with your own LibreTranslate instance or an API (with key).
*/

const API_URL = 'https://libretranslate.de/translate'; // public instance
const inputEl = document.getElementById('inputText');
const outputBox = document.getElementById('outputBox');
const fromSelect = document.getElementById('fromLang');
const toSelect = document.getElementById('toLang');
const translateBtn = document.getElementById('translateBtn');
const swapBtn = document.getElementById('swapBtn');
const copyBtn = document.getElementById('copyBtn');
const speakBtn = document.getElementById('speakBtn');
const loadingEl = document.getElementById('loading');
const statusEl = document.getElementById('status');
const lastUpdatedEl = document.getElementById('lastUpdated');
const charCount = document.getElementById('charCount');
const clearAllBtn = document.getElementById('clearAll');
const historyList = document.getElementById('historyList');
const saveHistoryBtn = document.getElementById('saveHistory');
const clearHistoryBtn = document.getElementById('clearHistory');

function setStatus(text) { statusEl.textContent = text; }
function showLoading(show) { loadingEl.classList.toggle('hidden', !show); }

function updateCharCount(){
  const n = inputEl.value.length;
  charCount.textContent = `${n} chars`;
}
inputEl.addEventListener('input', updateCharCount);

// swap languages
swapBtn.addEventListener('click', () => {
  const from = fromSelect.value;
  fromSelect.value = toSelect.value;
  toSelect.value = from;
});

// copy result
copyBtn.addEventListener('click', async () => {
  const text = outputBox.textContent.trim();
  if (!text) return;
  try {
    await navigator.clipboard.writeText(text);
    setStatus('Copied to clipboard');
    setTimeout(()=> setStatus('Ready'), 1500);
  } catch (e) {
    setStatus('Copy failed');
  }
});

// speak result (uses SpeechSynthesis; excludes Polish voice fallback if not available)
speakBtn.addEventListener('click', () => {
  const text = outputBox.textContent.trim();
  if (!text) return;
  const utter = new SpeechSynthesisUtterance(text);
  // set language for better pronunciation
  utter.lang = toSelect.value === 'pl' ? 'pl-PL' : 'en-US';
  speechSynthesis.speak(utter);
});

// clear all fields
clearAllBtn.addEventListener('click', () => {
  inputEl.value = '';
  outputBox.textContent = '';
  updateCharCount();
  setStatus('Cleared');
  setTimeout(()=> setStatus('Ready'), 1200);
});

// save to history (localStorage)
function loadHistory(){
  const h = JSON.parse(localStorage.getItem('translator_history') || '[]');
  renderHistory(h);
  return h;
}
function renderHistory(list){
  historyList.innerHTML = '';
  if (!list.length) {
    historyList.innerHTML = '<em class="text-gray-400">No saved translations yet.</em>';
    return;
  }
  for (let i=list.length-1;i>=0;i--){
    const item = list[i];
    const el = document.createElement('div');
    el.className = 'p-2 border rounded-lg bg-indigo-50 flex justify-between items-start gap-2';
    el.innerHTML = `<div class="text-sm"><strong>${escapeHtml(item.fromLang)} → ${escapeHtml(item.toLang)}</strong>
      <div class="mt-1 text-xs text-gray-700">${escapeHtml(item.input)}</div>
      <div class="mt-2 text-sm text-indigo-700">${escapeHtml(item.output)}</div>
      <div class="mt-1 text-xs text-gray-500">${new Date(item.ts).toLocaleString()}</div>
    </div>
    <div class="flex flex-col gap-2">
      <button class="history-copy bg-white border px-2 py-1 rounded-md text-xs">Copy</button>
      <button class="history-delete bg-white border px-2 py-1 rounded-md text-xs">Delete</button>
    </div>`;
    // attach handlers
    el.querySelector('.history-copy').addEventListener('click', async () => {
      await navigator.clipboard.writeText(item.output);
      setStatus('Copied');
      setTimeout(()=>setStatus('Ready'),1200);
    });
    el.querySelector('.history-delete').addEventListener('click', () => {
      const arr = JSON.parse(localStorage.getItem('translator_history') || '[]');
      arr.splice(i,1);
      localStorage.setItem('translator_history', JSON.stringify(arr));
      renderHistory(arr);
    });
    historyList.appendChild(el);
  }
}
saveHistoryBtn.addEventListener('click', () => {
  const input = inputEl.value.trim();
  const output = outputBox.textContent.trim();
  if (!input || !output) { setStatus('Nothing to save'); setTimeout(()=>setStatus('Ready'),1200); return; }
  const arr = JSON.parse(localStorage.getItem('translator_history') || '[]');
  arr.push({ fromLang: fromSelect.value, toLang: toSelect.value, input, output, ts: Date.now() });
  localStorage.setItem('translator_history', JSON.stringify(arr));
  renderHistory(arr);
  setStatus('Saved');
  setTimeout(()=>setStatus('Ready'),1200);
});
clearHistoryBtn.addEventListener('click', () => {
  localStorage.removeItem('translator_history');
  renderHistory([]);
  setStatus('History cleared');
  setTimeout(()=>setStatus('Ready'),1200);
});
loadHistory();

// helper to escape HTML in history display
function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// core translate function
async function translateText(text, from, to) {
  // LibreTranslate expects 'q', 'source', 'target', and optionally 'format'
  // NOTE: using public instance - for heavy use host your own instance or an API key endpoint.
  setStatus('Translating...');
  showLoading(true);
  try {
    const resp = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        q: text,
        source: from,
        target: to,
        format: "text"
      })
    });
    if (!resp.ok) {
      throw new Error('Network response was not ok: ' + resp.status);
    }
    const data = await resp.json();
    showLoading(false);
    setStatus('Ready');
    // data has { translatedText: "..." }
    return data.translatedText || '';
  } catch (err) {
    showLoading(false);
    console.error(err);
    setStatus('Translation failed — network or CORS error');
    return '';
  }
}

// translate button handler
translateBtn.addEventListener('click', async () => {
  const text = inputEl.value.trim();
  if (!text) { setStatus('Please enter text to translate'); return; }
  const from = fromSelect.value;
  const to = toSelect.value;
  outputBox.textContent = '';
  const t = await translateText(text, from, to);
  if (t) {
    outputBox.textContent = t;
    lastUpdatedEl.textContent = 'Last translated: ' + new Date().toLocaleTimeString();
  }
});

// allow Enter+Ctrl to translate in textarea (so Enter alone still adds newline)
inputEl.addEventListener('keydown', (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    e.preventDefault();
    translateBtn.click();
  }
});

// Auto-detect (simple heuristic: look for polish characters or english words)
// This will simply toggle the from language for convenience
document.getElementById('autoDetectBtn').addEventListener('click', () => {
  const txt = inputEl.value;
  if (!txt.trim()) { setStatus('Type text to auto-detect'); return; }
  // naive detection: presence of characters like ąęółżźćń suggests Polish
  const polishChars = /[ąćęłńóśżźĄĆĘŁŃÓŚŻŹ]/;
  if (polishChars.test(txt)) {
    fromSelect.value = 'pl';
    toSelect.value = 'en';
    setStatus('Auto-detected: Polish → English');
  } else {
    // default to English -> Polish
    fromSelect.value = 'en';
    toSelect.value = 'pl';
    setStatus('Auto-detected: English → Polish');
  }
  setTimeout(()=>setStatus('Ready'),1000);
});

// initialize UI
updateCharCount();
renderHistory(JSON.parse(localStorage.getItem('translator_history') || '[]'));

// small note: if you run into CORS errors when opening via file://, host the page via a server
</script>
</body>
</html>